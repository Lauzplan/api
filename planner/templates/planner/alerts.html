{% extends "planner/base.html" %}

{% block extra_js %}
    {% load static %}
    <script src="{% static 'planner/js/sorttable.js' %}"></script>
{% endblock extra_js %}

{% block content %}

    <!-- Modal -->
    <div class="modal fade" id="modal-add_seed" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
    </div>
    <div class="modal fade" id="modal-validate_alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
    </div>
    <div class="modal fade" id="modal-postpone_alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
    </div>
    <div class="modal fade" id="modal-delete_alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
    </div>
    <!-- Modal -->

    <div class="col-md-8">
        <div>
            <a class="glyphicon glyphicon-plus btn btn-success" data-toggle="modal"
               href="{% url 'planner:add_seed_view' garden.id %}"
               data-target="#modal-add_seed" title="add item" data-tooltip>Ajouter un semis</a>
        </div>
        <br/>

        <div class="panel panel-default ">
            <div class="panel-heading">Opérations à faire</div>
            <div class="panel-body">
                {% load planner_extras %}
                {% load l10n %}
                <div class="table-responsive">
                    <table class="table sortable">
                        <thead>
                        <tr>
                            <th>Plantation</th>
                            <th>Légume</th>
                            <th>Action</th>
                            <th> A faire le</th>
                            <th></th>
                        </tr>
                        </thead>
                        {% for current_alert in alerts %}
                            <tbody>
                            <tr>
                                <td><b>{{ current_alert.area_concerned.label }} </b></td>
                                <td>{{ current_alert.area_concerned.vegetable }}</td>
                                <td>{{ current_alert.original_cultural_operation.name }}</td>
                                <td>{% due_date current_alert history as current_due_date %} {{ current_due_date|date:"j F" }} </td>
                                <td>
                                    <a class="glyphicon glyphicon-ok" data-toggle="modal"
                                       href="{% url 'planner:validate_alert_view' garden.id current_alert.id %}"
                                       data-target="#modal-validate_alert" title="Valider l'action" data-tooltip></a>
                                    <a class="glyphicon glyphicon-repeat" data-toggle="modal"
                                       href="{% url 'planner:postpone_alert_view' garden.id current_alert.id %}"
                                       data-target="#modal-postpone_alert" title="Reporter l'action" data-tooltip></a>
                                    <a class="glyphicon glyphicon-remove" data-toggle="modal"
                                       href="{% url 'planner:delete_alert_view' garden.id current_alert.id %}"
                                       data-target="#modal-delete_alert" title="Supprimer l'action" data-tooltip></a>
                                </td>
                            </tr>
                            </tbody>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class=" col-md-3 col-md-offset-1">
        <div class="panel panel-default ">
            <div class="panel-heading">Historique</div>
            <div class="panel-body">

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Action</th>
                            <th>Date</th>
                        </tr>
                        </thead>
                        {% for op in history %}
                            <tbody>
                            <tr>
                                <td><b>
                                    {{ op.is_deleted }}{{ op.area_concerned.label }} </b> {{ op.original_cultural_operation.name }}
                                </td>
                                <td>{{ op.execution_date }}</td>
                            </tr>
                            </tbody>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        $('#modal-add_seed').on('show.bs.modal', function (event) {
            var modal = $(this)
            var link = $(event.relatedTarget);
            modal.load(link.attr("href"));
        })
        $('#modal-validate_alert').on('show.bs.modal', function (event) {
            var modal = $(this)
            var link = $(event.relatedTarget);
            modal.load(link.attr("href"));
        })
        $('#modal-postpone_alert').on('show.bs.modal', function (event) {
            var modal = $(this)
            var link = $(event.relatedTarget);
            modal.load(link.attr("href"));
        })
        $('#modal-delete_alert').on('show.bs.modal', function (event) {
            var modal = $(this)
            var link = $(event.relatedTarget);
            modal.load(link.attr("href"));
        })
    </script>
{% endblock content %}